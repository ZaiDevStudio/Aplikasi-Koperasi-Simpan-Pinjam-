<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Tambah Pinjaman</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body class="bg-gold-theme">
    
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container">
            <a class="navbar-brand" href="index.html">Tambah Pinjaman</a>
            <div class="ms-auto">
                <a href="index.html" class="text-white"><i class="fas fa-home"></i></a>
            </div>
        </div>
    </nav>

    <div class="container mt-5 pt-5 mb-5">
        <div class="card p-4 shadow">
            <form id="formPinjaman">
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Tanggal</label>
                        <input type="date" id="tgl" class="form-control" required>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Nama Nasabah</label>
                        <select id="inputNamaNasabah" class="form-select" required></select>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Pinjaman Ke-</label>
                        <input type="number" id="pinjamanKe" class="form-control" value="1">
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Pinjaman Pokok (Rp)</label>
                        <input type="number" id="pokok" class="form-control" placeholder="Contoh: 1000000" required>
                    </div>
                    
                    <div class="col-6 mb-3">
                        <label class="form-label">Jasa (%)</label>
                        <input type="number" id="jasaPersen" class="form-control" value="20">
                    </div>
                    <div class="col-6 mb-3">
                        <label class="form-label">Tabungan (%)</label>
                        <input type="number" id="tabunganPersen" class="form-control" value="0">
                        <input type="hidden" id="inputTabunganNominal">
                    </div>
                    <div class="col-6 mb-3">
                        <label class="form-label">Biaya Admin (%)</label>
                        <input type="number" id="adminPersen" class="form-control" value="5">
                    </div>
                    
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Total Harus Dibayar</label>
                        <input type="text" id="totalBayar" class="form-control bg-light" readonly>
                    </div>

                    <div class="col-md-4 mb-3">
                        <label class="form-label">Tipe Cicilan</label>
                        <select id="tipeCicilan" class="form-select">
                            <option value="Harian">Harian</option>
                            <option value="Mingguan">Mingguan</option>
                            <option value="Bulanan">Bulanan</option>
                        </select>
                    </div>
                    <div class="col-md-4 mb-3">
                        <label class="form-label">Jml Angsuran</label>
                        <input type="number" id="tenor" class="form-control" value="10">
                    </div>
                    <div class="col-md-4 mb-3">
                        <label class="form-label">Nominal Cicilan</label>
                        <input type="text" id="nominalCicilan" class="form-control bg-light fw-bold text-danger" readonly>
                    </div>

                    <div class="col-12 mb-3">
                        <div class="alert alert-success text-center">
                            <label>Uang Diterima (Cair)</label>
                            <input type="text" id="uangDiterima" class="form-control text-center fw-bold fs-4" readonly>
                        </div>
                    </div>
                </div>
                <button type="submit" class="btn btn-primary w-100 btn-lg shadow">Simpan Pinjaman</button>
            </form>
        </div>
    </div>

    <footer>@2025 Koperasi Simpan Pinjam. Developer Y. Zai, A.Md.Kom</footer>
    
    <script src="script.js"></script>
    <script>
        document.getElementById('tgl').valueAsDate = new Date();

        document.getElementById('formPinjaman').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const dataPinjaman = {
                idPinjaman: Date.now(),
                tanggal: document.getElementById('tgl').value,
                nama: document.getElementById('inputNamaNasabah').value,
                pinjamanKe: document.getElementById('pinjamanKe').value,
                pokok: parseFloat(document.getElementById('pokok').value),
                totalBayar: parseFloat(document.getElementById('totalBayar').value),
                sisaSaldo: parseFloat(document.getElementById('totalBayar').value),
                tipeCicilan: document.getElementById('tipeCicilan').value,
                jmlAngsuran: parseInt(document.getElementById('tenor').value),
                sisaAngsuran: parseInt(document.getElementById('tenor').value),
                nominalCicilan: parseFloat(document.getElementById('nominalCicilan').value),
                tabunganMasuk: parseFloat(document.getElementById('inputTabunganNominal').value),
                status: 'Belum Lunas',
                historyPembayaran: []
            };

            // Simpan Data Pinjaman
            let pinjamanDB = getDB('pinjamanDB');
            pinjamanDB.push(dataPinjaman);
            setDB('pinjamanDB', pinjamanDB);

            // Update Data Tabungan
            let tabunganDB = getDB('tabunganDB');
            let existingTabungan = tabunganDB.find(t => t.nama === dataPinjaman.nama);
            if(existingTabungan) {
                existingTabungan.total += dataPinjaman.tabunganMasuk;
            } else {
                tabunganDB.push({ nama: dataPinjaman.nama, total: dataPinjaman.tabunganMasuk });
            }
            setDB('tabunganDB', tabunganDB);

            alert('Pinjaman Berhasil Disimpan!');
            window.location.href = 'pinjaman.html';
        });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
